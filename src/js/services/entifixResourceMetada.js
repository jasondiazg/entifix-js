// ENTIFIX RESOURCE METADATA PROVIDER *************************************************************************
// ============================================================================================================
// ============================================================================================================ 
// ============================================================================================================
(function(){
    'use strict';

    var module = angular.module('entifix-js');

    module.provider("EntifixResourceMetadata", [function () {
        
        var prov = this;

        var $mainAPI;

        prov.setMainAPI = function(value) {
            $mainAPI = value;
        };

        prov.$get = ['$http','$mdToast', function ($http, $mdToast) {

            var sv = {}

            //Properties and Fields___________________________________________________________________________________________________________________________
            //================================================================================================================================================
            
            //Fields

            //Properties
             
            //================================================================================================================================================

            //Methods_________________________________________________________________________________________________________________________________________
            //================================================================================================================================================
            function actionSuccess(response){
                mergeMetadata(response.data.data);
            }

            function actionError(){
                $mdToast.show(
                    $mdToast.simple()
                        .textContent('Error when trying to load metadata...')
                            .position('bottom right')
                                .hideDelay(3000)
                );
            }

            function mergeMetadata(metadata){
                globalMetadata.resources.forEach(element => {
                    metadata.forEach(element_loaded => {
                        if (element.name == element_loaded.resourceName)
                            element.url = element_loaded.apiUrl;
                    });
                });
            }

            // Public section _____________________________________________________________________
            sv.loadMetadata = function() {
                $http({ method: 'GET', url: $mainAPI }).then(actionSuccess, actionError);
            }
            
            //================================================================================================================================================


            return sv;
        }];
        // ============================================================================================================================================================================================================================
        // ============================================================================================================================================================================================================================

    }]);

})();